第一步记得到ubuntu的pod中models/Stable-diffusion/%(sd_base_model_name)s去下载基础模型


全部创建命令-----
kubectl apply -f  %(k8s_subdir_name)s/deployment.yaml
kubectl apply -f  %(k8s_subdir_name)s/service_inference_multi.yaml
kubectl apply -f  %(k8s_subdir_name)s/hpa.yaml


删除命令----
kubectl delete  deployment sd-deployment-%(sd_base_model_name)s
kubectl delete  hpa sd-hpa-%(sd_base_model_name)s
kubectl delete  backendconfig sd-backendconfig-%(sd_base_model_name)s
kubectl delete  service sd-service-%(sd_base_model_name)s
kubectl delete  ingress sd-ingress-%(sd_base_model_name)s

重新部署pod(更新镜像)---
kubectl rollout restart deployment sd-deployment-%(sd_base_model_name)s


将deployment的ingress加入到Cloud Armor里面(当ingress创建完成后执行)------
gcloud compute backend-services update $(gcloud compute backend-services list --filter="name~'%(sd_base_model_name)s'" --format="value(name)") --security-policy=sd-web-ui --global  #黄色后缀#"--

用于特殊测试的命令, 将deployment的ingress安全策略移除(所有ip都可以访问)-----一般不用----------
gcloud compute backend-services update $(gcloud compute backend-services list --filter="name~'%(sd_base_model_name)s'" --format="value(name)") --security-policy="" --global  #黄色后缀#"--



修改yuanxiao_kubernetes/sd_public_ingress.yaml
   加入下面一段然后执行
   kubectl apply -f sd_public_ingress.yaml 
   即可
   -----
   - host: %(sd_base_model_name)s.sd.com
    http:
        paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: sd-service-%(sd_base_model_name)s
              port:
                number: 8080
   -----
   加入域名映射; ingress的公网ip可以点进去看到
   或者本地hosts也支持，只需要vi /etc/hosts; 修改后source /etc/hosts即可